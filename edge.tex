\begin{Verbatim}[commandchars=@\[\],numbers=left,firstnumber=1,stepnumber=1]
@PYay[class] @PYaO[Edge] @PYbd[<] @PYaq[ActiveRecord]@PYbd[::]@PYaq[Base]
  @PYaf[# ...]

  @PYay[def] @PYaL[longest_road](visited_roads @PYbd[=] @PYaq[Set]@PYbd[.]new, skip_roads @PYbd[=] @PYaq[Set]@PYbd[.]new)
    visited_roads @PYbd[<<] @PYaX[self]

    @PYaf[# left roads]
    unvisited_left_roads @PYbd[=]
      @PYaq[Set]@PYbd[.]new(left_roads) @PYbd[-] visited_roads @PYbd[-] skip_roads

    left_road_lenghts @PYbd[=] unvisited_left_roads@PYbd[.]map @PYay[do] @PYbd[|]road@PYbd[|]
      lenght, new_visited_roads @PYbd[=]
        road@PYbd[.]longest_road(visited_roads, unvisited_left_roads)

      visited_roads @PYbd[+=] new_visited_roads
      lenght
    @PYay[end]

    @PYaf[# right roads]
    unvisited_right_roads @PYbd[=]
      @PYaq[Set]@PYbd[.]new(right_roads) @PYbd[-] visited_roads @PYbd[-] skip_roads

    right_road_lenghts @PYbd[=] unvisited_right_roads@PYbd[.]map @PYay[do] @PYbd[|]road@PYbd[|]
      lenght, new_visited_roads @PYbd[=]
        road@PYbd[.]longest_road(visited_roads, unvisited_right_roads)

      visited_roads @PYbd[+=] new_visited_roads
      lenght
    @PYay[end]

    longest_road @PYbd[=] @PYag[1] @PYbd[+]
      (left_road_lenghts@PYbd[.]max @PYav[or] @PYag[0]) @PYbd[+]
      (right_road_lenghts@PYbd[.]max @PYav[or] @PYag[0])

    @PYbd[@lb[]]longest_road, visited_roads@PYbd[@rb[]]
  @PYay[end]

  @PYaf[# ...]
@PYay[end]
\end{Verbatim}
